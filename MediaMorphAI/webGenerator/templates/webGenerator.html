{% extends 'generateWebLayout.html' %}
{% load static %}
{% block title %} MediaMorph AI | Generate Website {% endblock %}
{% block content %}
<div class="container">
    <p class="greet">Welcome, {{user}}</p>
    <div class="subContainer">
        <a href="/accounts/logout" class="logoutBtn">Logout</a>
    </div>
</div>
<div class="main-container fade-in">
    <form method="POST" onsubmit="return false;" class="qnaform">
        {% csrf_token %}
        <label class="question" id="question">What is the question? {{ question }}</label>
        <div class="formcontainer">
            <input type="text" class="answer" name="answer" placeholder="Enter the response here" id="responseText"
                required>
            <button class="quesBtn" type="submit" id="continue-btn">Continue <i
                    class="fa-solid fa-arrow-right arrow"></i></button>
        </div>
    </form>
    <form id="final-form" method="POST" action="{% url 'preview' %}"></form>
    {% csrf_token %}
    <input type="hidden" name="responses" id="responses">
    </form>
</div>
<footer class="footer">
    <p>MediaMorph AI | Developed by
        <a href="mailto:msharan.hnp@gmail.com" class="DevInfo">Sharan</a>
        • <a href="mailto:rohanms0405@gmail.com" class="DevInfo">Rohan</a>
        • <a href="mailto:24ranjith2003@gmail.com" class="DevInfo">Ranjith</a>
        • <a href="mailto:shivamv1972@gmail.com" class="DevInfo">Vishnu</a>
    </p>
    <div>
        <a href="/generateimage" class="footernav">Generate Image</a>
        {% if user.is_authenticated and user.is_superuser %}
        <a href="/feedbacks" class="footernav">Feedbacks</a>
        {% endif %}
    </div>
</footer>
<script src="https://kit.fontawesome.com/b2b6d427ae.js" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let quest = document.getElementById('question');
    let questions = [
        'What is the primary purpose of the website?',
        'What sections do you want on the landing page (e.g., hero, about, services, contact)?',
        'Do you have a preferred color scheme or branding guidelines for the website?',
        'What type of layout do you prefer: centered, full-width, or a mix of both?',
        'What kind of navigation menu do you want: horizontal, vertical, or a hamburger menu?',
        'Will you need a logo or placeholder for the logo? If yes, provide the text or image details.',
        'What kind of fonts do you prefer, or do you want to use default web fonts?',
        'Do you want any specific animations or transitions (e.g., fade in, slide up, etc.)?',
        'What are the specific features or elements you want to be animated?',
        'Do you want any specific images or icons to be included? If so, provide details or specify "Image here."',
        'Do you need any social media links or icons? If yes, please provide the details.',
        'Should there be any specific call-to-action buttons? If so, what should they say?',
        'Do you require any specific responsiveness features, such as mobile view adjustments or tablet view designs?',
        'Are there any specific styles or themes you want for the buttons or form inputs?',
        'For the "Contact" section, what form fields do you need (e.g., name, email, message)?',
        'Should the contact form have any specific validation rules (e.g., required fields, email format)?',
        'Do you have any additional requirements or features you want to include on the landing page? If so, provide details.'
    ];

    let responses = [];
    let currentQuestionIndex = 0;

    const questionText = document.getElementById('question');
    const responseInput = document.getElementById('responseText');
    const continueButton = document.getElementById('continue-btn');
    const hiddenResponsesInput = document.getElementById('responses');

    questionText.textContent = questions[currentQuestionIndex];

    continueButton.addEventListener('click', function () {
        const userResponse = responseInput.value;

        if (userResponse.trim() === "") {
            alert("Please provide an answer.");
            return;
        }
        responses.push({
            question: questions[currentQuestionIndex],
            answer: userResponse
        });

        responseInput.value = '';

        currentQuestionIndex++;

        if (currentQuestionIndex < questions.length) {
            questionText.textContent = questions[currentQuestionIndex];
        } else {
            hiddenResponsesInput.value = JSON.stringify(responses);
            document.getElementById('final-form').submit();
            // console.log(hiddenResponsesInput.value);
        }
    });

    // Function to get CSRF token from the cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    // Include CSRF token in AJAX requests
    fetch('/preview/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken  // Add the CSRF token to the request headers
        },
        body: JSON.stringify({ responses: responses })
    })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error('Error:', error));

</script>
{% endblock %}